"use strict"; (self.webpackChunkbaige = self.webpackChunkbaige || []).push([[829], {
    44088: function (e, t, o) { o.d(t, { A: function () { return s } }); var l, n = o(70302), a = o(19122), i = o(38308), r = (o(69138), o(34192), o(51565), o(15342), o(51872)); function d(e, t, o, n) { l || (l = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var a = e && e.defaultProps, i = arguments.length - 3; if (t || 0 === i || (t = { children: void 0 }), 1 === i) t.children = n; else if (i > 1) { for (var r = Array(i), d = 0; d < i; d++)r[d] = arguments[d + 3]; t.children = r } if (t && a) for (var s in a) void 0 === t[s] && (t[s] = a[s]); else t || (t = a || {}); return { $$typeof: l, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } function s({ selectedRows: e, all: t, setSelectedRows: o, columns: l, fileName: s }) { const u = (0, i.useCallback)(((n = "selected") => { !function ({ data: e, columns: t, fileName: o }) { const l = [], n = t.map((({ label: e }) => e)); l.push(n.join(",")), e.forEach((e => { const o = t.map((({ value: t }) => "string" == typeof t ? e[t] : "function" == typeof t ? t(e) : "")); l.push(o.join(",")) })); const a = l.join("\n"); (0, r.P)({ content: a, fileName: o, mimeType: "text/csv;charset=utf-8;" }) }({ columns: l, data: "all" === n ? t : e, fileName: s }), o([]) }), [t, l, s, e, o]); return d(n.A, {}, void 0, d(a.A, { onClick: () => u("selected"), disabled: 0 === e.length }, void 0, "下载选中"), d(a.A, { onClick: () => u("all") }, void 0, "下载全部")) } s.displayName = "ProTableContentDownloader" }, 75300: function (e, t, o) { o.d(t, { p: function () { return l } }); let l = function (e) { return e.a800 = "a800", e.p800 = "p800", e }({}) }, 22662: function (e, t, o) {
        o.r(t), o.d(t, { default: function () { return Pl } }), o(69138); var l = o(38308), n = o.n(l), a = o(45926), i = o(50494), r = o(18066), d = o(91426), s = o(96782), u = o(66159), c = o(53683), v = o(79547), p = o(47825), m = o(14807); o(85130), o(55636), o(28509), o(97332), o(46555), o(13296), o(24594), o(44837), o(10823), o(46465), o(11143), o(30704), o(57785), o(68243), o(69540), o(38659), o(72354), o(79086), o(454), o(66656), o(8486), o(83), o(18039); const f = { silence: !0, errorRequest: void 0 }; function y(e, t = f) { const { silence: o, errorRequest: n } = t, [a, i] = (0, l.useState)(new Set), [r, d] = (0, l.useState)(""), s = (0, l.useCallback)((async (...t) => { const l = null != n ? n : JSON.stringify(t); var r; if (d(l), !o || !a.has(l)) try { const o = await e(...t); return o && o.success || (r = o, console.error("AIHC ERROR: ", r), i((e => e.add(l)))), o } catch (e) { i((e => e.add(l))) } }), [e, n, a, o]); return (0, l.useEffect)((() => () => { a.delete(r) }), [r, a]), s } var h = o(82947), b = o(65908), g = o(82534), A = o(18419), k = o(48903), S = o(44472), N = (o(34192), o(4865), o(20031), o(87455)), I = o(15496), C = o(6557), P = o(1302), D = o(7401), w = (o(15342), o(92935)), F = o(88913), $ = o(83340), x = o(36983); const j = e => { const { data: t, isLoading: o, mutate: l, isValidating: n } = (0, r.Ay)(e, (() => (0, F.p)(e))); return { task: t, pending: o || n, refresh: l } }, T = ({ clusterUuid: e, k8sName: t, k8sNamespace: o, kind: n, queueID: a }) => { const { task: i, pending: r } = j({ clusterUuid: e, k8sName: t, k8sNamespace: o, kind: n, queueID: a }), d = (0, l.useMemo)((() => ((null == i ? void 0 : i.jobDetail.podList.pods) || []).map((e => ({ label: (0, x.Sb)(e.objectMeta.name, e.nodeName), value: e.objectMeta.name, ip: e.nodeName, name: e.objectMeta.name, status: e.podStatus.podPhase, ...e }))).sort(((e, o) => (0, $.n)(e.name.replace(`${t}-`, ""), o.name.replace(`${t}-`, ""))))), [t, null == i ? void 0 : i.jobDetail.podList.pods]), s = (0, l.useMemo)((() => (0, w.keyBy)(d, "name")), [d]); return [d, s, { pending: r }] }; var R, U, M, O = o(60079), q = o(48973); function L({ mode: e, options: t, value: o, onChange: n, selectFirst: a }) { (0, l.useEffect)((() => { !o && null != t && t.length && (null == a || a(t)) }), [t, a, o]); const i = "multiple" === e ? { mode: "multiple" } : {}; return (0, q.Y)(O.A, { ...i, showSearch: !0, options: t, style: { minWidth: 300 }, onChange: n, value: o, placeholder: "请选择实例" }) } function E(e, t, o, l) { M || (M = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: M, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } function B() { var e; const { k8sName: t, k8sNamespace: o, kind: n, clusterUuid: a, queueID: i } = (0, c.I)(), [r] = T({ k8sName: t, k8sNamespace: o, kind: n, clusterUuid: a, queueID: i }), { task: d } = j({ k8sName: t, k8sNamespace: o, kind: n, clusterUuid: a, queueID: i }), s = (0, l.useMemo)((() => null == d ? void 0 : d.jobDetail), [null == d ? void 0 : d.jobDetail]), u = "true" === (null == s || null === (e = s.env) || void 0 === e ? void 0 : e.LOG_COLLECTION), v = (0, l.useMemo)((() => { var e; const t = null == s || null === (e = s.annotations) || void 0 === e ? void 0 : e["aijob.cce.baidubce.com/timeline"]; try { var o; return (null === (o = (JSON.parse(t) || []).find((e => "Running" === e.conditionType))) || void 0 === o ? void 0 : o.time) || null } catch (e) { return null } }), [null == s ? void 0 : s.annotations]), p = (0, l.useMemo)((() => { let e = null != s && s.finishedAt ? (0, I.A)(s.finishedAt).subtract(1, "day") : (0, I.A)().subtract(1, "day"); const t = null != s && s.finishedAt ? (0, I.A)(s.finishedAt) : (0, I.A)(); if (v) { const t = (0, P.RB)(v); t.isAfter(e) && (e = t) } return [e, t] }), [null == s ? void 0 : s.finishedAt, v]), m = (0, l.useMemo)((() => { var e; return { limit: 500, podName: null == r || null === (e = r[0]) || void 0 === e ? void 0 : e.value, time: { startDateTime: (0, P.cs)(p[0]), endDateTime: (0, P.cs)(p[1]) }, sort: "asc", taskType: "stdout" } }), [r, p]), f = (0, l.useCallback)((e => (0, q.Y)(L, { ...e, selectFirst: !0, options: r })), [r]); return E(D.i, { isBlsOn: u, clusterUuid: a, queueID: i, logStoreName: "aihcp-aijob-log", queryFormInitialValues: m, PodListSelect: f, isTask: !0 }) } L.displayName = "PodListSelect", B.displayName = "TaskBLSLog"; var K, _, H = () => E(N.l$, { pendingFallback: E(C.ui, { style: { width: "100%", height: 400 } }, void 0, R || (R = E(d.A, {}))) }, void 0, U || (U = E(B, {}))), J = (o(80456), o(96806)), W = o(70302), Y = o(20642), G = o(42006), Q = o(19122), V = o(95611), z = o(97728), Z = o(79927), X = o(10408), ee = o(13789), te = o(49890), oe = (o(51565), o(74180)), le = o(79944), ne = o(59678); function ae(e, t, o, l) { _ || (_ = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: _, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } function ie() { const { k8sName: e, clusterUuid: t, queueID: o } = (0, c.I)(), [n, a] = (0, l.useState)(!1), [i, { on: r, off: d }] = (0, A.Cg)(), s = (0, l.useRef)(0); (0, l.useEffect)((() => () => clearInterval(s.current)), []); const u = (0, l.useCallback)((async () => { try { const l = await (0, p.c15)({ clusterUuid: t, k8sName: e, queueID: o }); 200 === l.result.code ? "success" === l.result.status && (clearInterval(s.current), a(!1), d(), l.result.bosAddressList.forEach(((o, l) => { const n = document.createElement("a"); n.href = o, n.download = `${t}-${e}-log${l}.zip`, document.body.appendChild(n), n.click(), document.body.removeChild(n) }))) : (oe.A.error(l.message), clearInterval(s.current), d(), a(!1)) } catch (e) { oe.A.error(e), clearInterval(s.current), d(), a(!1) } }), [t, e, d, o]), v = (0, l.useCallback)((async () => { try { const l = await (0, p.Q29)({ clusterUuid: t, k8sName: e, queueID: o }); 200 === l.result.code ? (a(!0), s.current = setInterval((() => { u() }), 5e3), r()) : oe.A.error(l.result.message) } catch { oe.A.error("请求失败，请重试") } }), [t, e, o, r, u]); return (0, q.FD)(q.FK, { children: [ae(le.A, { title: "将下载任务全部实例的日志到本地，仅支持标准输出的日志类型" }, void 0, ae(Q.A, { loading: n, type: "primary", style: { marginLeft: 8 }, onClick: v }, void 0, "日志下载")), ae(z.A, { title: "日志下载", open: i, onOk: d, onCancel: d }, void 0, K || (K = ae(ne.A, { showIcon: !0, type: "warning", message: "日志下载链接生成中...请勿关闭或刷新此页面" })), ae("div", { style: { marginTop: 10 } }, void 0, "日志下载链接生成时间受任务日志量的影响，若此页面长时间无反应，请关闭页面，重新下载"))] }) } ie.displayName = "DownloadLog"; var re, de, se, ue, ce, ve, pe, me, fe, ye = (0, o(39395).vt)(((e, t) => ({ logsParams: { keywords: "" }, setLogParams: (t, o) => e((e => ({ logsParams: { ...e.logsParams, [t]: { ...e.logsParams[t], ...o } } }))), getLogParams: e => t().logsParams[e] }))); function he(e, t, o, l) { fe || (fe = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: fe, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const be = ({ log: e, id: t, getLogCallback: o, height: n, podName: a }) => { var i; const [r, { on: d, off: s }] = (0, A.Cg)(), { setLogParams: u, getLogParams: c } = ye((e => ({ setLogParams: e.setLogParams, getLogParams: e.getLogParams }))), v = (null === (i = c(a)) || void 0 === i ? void 0 : i.keywords) || "", p = (0, l.useCallback)((async () => { d(); const e = c(a); o && await o(e), s() }), [o, c, a, s, d]), m = (0, l.useCallback)((async e => { u(a, { keywords: e }), p() }), [p, a, u]); (0, l.useEffect)((() => () => { u(a, { keywords: "", page: 1 }) }), [a, u]); const { content: f } = e; return he("div", {}, void 0, he(J.A, { color: "blue" }, void 0, t), he("div", { className: S.A["container-time-range"] }, void 0, re || (re = he("div", {}, void 0, "仅展示最近5000条日志，可以通过日志下载或开启日志持久化查看全部日志。")), he("div", {}, void 0, he(W.A, { align: "baseline" }, void 0, he(Y.A.Search, { placeholder: "请输入关键字搜索", onSearch: m }), he(te.A, { onClick: p })))), he(ee.A, { pagination: !0, searchKeywords: v, highlight: !0, loading: r, content: f, style: { height: n } })) }; function ge({ openFullScreen: e, closeFullScreen: t, fullScreen: o }) { const { k8sName: n, k8sNamespace: a, kind: i, clusterUuid: r, podName: s, queueID: u } = (0, c.I)(), [v, m, { pending: f }] = T({ k8sName: n, k8sNamespace: a, kind: i, clusterUuid: r, queueID: u }), [h, b] = (0, l.useState)(void 0), [g, A] = (0, l.useState)({}), [k, I] = (0, l.useState)(!1), D = (0, l.useRef)(0), F = (0, l.useCallback)((() => { I(!1), clearInterval(D.current) }), []), { getLogParams: j } = ye((e => ({ getLogParams: e.getLogParams }))), R = y(p.FeQ), U = (0, l.useCallback)((async ({ pod: e, container: t, keywords: o }) => { const l = (await R({ clusterUuid: r, queueID: u, namespace: a, podName: e, container: t, keywords: o, kind: i, jobName: n })).result, d = (0, w.get)(l, "logs", []) || [], s = (0, w.get)(l, "info", {}) || [], { fromDate: c, toDate: v } = s, p = { content: (null == d ? void 0 : d.map((e => ({ ...e, timestamp: (0, P.RQ)(e.timestamp), rawTimestamp: e.timestamp })))) || [], fromDate: c ? (0, P.RQ)(c) : "", toDate: v ? (0, P.RQ)(v) : "", pod: e, container: t }; return A((t => { const o = Object.entries(t).reduce(((e, [t, o]) => (h && h.includes(t) && (e[t] = o), e)), {}); return { ...o, [e]: p } })), l }), [r, n, a, i, u, R, h]), M = (0, l.useCallback)((async () => { try { await Promise.all(h ? h.map((async e => { var t; const o = (0, x.Qt)(i, m[e]), l = null === (t = j(e)) || void 0 === t ? void 0 : t.keywords; await U({ pod: e, container: o, keywords: l }) })) : []) } catch (e) { F() } }), [U, j, i, m, h, F]), O = (0, l.useCallback)((e => { e && e.length > 2 || b(e) }), []); (0, l.useEffect)((() => { h && h.length && M() }), [M, h]), (0, l.useEffect)((() => { if (clearInterval(D.current), k) return D.current = setInterval((() => { M() }), 4e3), () => clearInterval(D.current); clearInterval(D.current) }), [k, M, JSON.stringify(h)]); const q = Object.entries(g).sort((([e], [t]) => (0, $.n)(e.replace(`${n}-`, ""), t.replace(`${n}-`, "")))), E = f ? he(C.ui, { style: { height: 350 } }, void 0, de || (de = he(d.A, {}))) : he("div", { className: S.A["container-log-set"] }, void 0, q.map((([e, t]) => { var l; const a = (0, x.Qt)(i, m[e]); return he(N.l$, { pendingFallback: se || (se = he(d.A, {})) }, e, he(be, { id: (0, x.Sb)(t.pod, null == m || null === (l = m[t.pod]) || void 0 === l ? void 0 : l.ip), clusterUuid: r, taskName: n, podName: t.pod, log: t, getLogCallback: e => U({ pod: t.pod, container: a, keywords: null == e ? void 0 : e.keywords }), height: o ? "auto" : "calc(100vh - 340px)", podStatus: null == m ? void 0 : m[t.pod].status })) })), 0 === q.length && he(C.ui, { style: { height: 350 } }, void 0, "暂无数据")), B = (0, l.useCallback)((e => { s ? O([s]) : e.length > 1 ? O([e[0].value, e[e.length - 1].value]) : O([e[0].value]) }), [O, s]); return he(C.R, { height: o ? "100%" : "calc(100vh - 173px)" }, void 0, he("div", { className: S.A["select-container"] }, void 0, he("div", { className: S.A["podlist-select"] }, void 0, ue || (ue = he("span", {}, void 0, "实例： ")), he(L, { mode: "multiple", options: v, value: h, selectFirst: B, onChange: O }), ce || (ce = he(Z.A, { disabled: !0 }, void 0, "（最多支持选择两个）"))), he(G.A, { onChange: e => I(e.target.checked), className: S.A["auto-refresh"], checked: k }, void 0, "开启自动刷新"), he(Q.A, { type: "text", flexCenter: !0, icon: ve || (ve = he(X.A, {})), onClick: e }, void 0, "全屏"), pe || (pe = he(ie, {}))), me || (me = he(V.A.Vertical, { factor: 5, base: 4 })), o ? he(z.A, { fullScreen: !0, open: !0, onCancel: t, footer: null }, void 0, he("div", { style: { padding: 20 } }, void 0, E)) : E) } ge.displayName = "TaskLog"; var Ae, ke, Se, Ne, Ie, Ce, Pe = ge, De = o(80562), we = o(49679); function Fe(e, t, o, l) { Ce || (Ce = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Ce, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const $e = ({ log: e, id: t, height: o, style: l }) => { const [n] = (0, A.Cg)(), { content: a } = e; return Fe("div", { style: l }, void 0, Fe(J.A, { color: "blue" }, void 0, t), Fe(ee.A, { loading: n, content: a, style: { height: o } })) }; function xe({ openFullScreen: e, closeFullScreen: t, fullScreen: o }) { const { k8sName: n, k8sNamespace: a, kind: i, clusterUuid: r, queueID: s } = (0, c.I)(), [u, v, { pending: m }] = T({ k8sName: n, k8sNamespace: a, kind: i, clusterUuid: r, queueID: s }), f = (0, l.useMemo)((() => u.map((({ value: e }) => e))), [JSON.stringify(u)]), [y, h] = (0, l.useState)(10), [b, g] = (0, l.useState)(Date.now()), [A, k] = (0, we.e)({}), N = (0, l.useCallback)((async ({ pod: e, container: t }) => { const { result: o } = await p.FeQ({ clusterUuid: r, namespace: a, podName: e, container: t, queueID: s }), l = (0, w.get)(o, "logs", []) || [], n = (0, w.get)(o, "info", {}) || [], { fromDate: i, toDate: d } = n, u = { content: (null == l ? void 0 : l.map((e => ({ ...e, timestamp: (0, P.RQ)(e.timestamp), rawTimestamp: e.timestamp })))).slice(-y), fromDate: i ? (0, P.RQ)(i) : "", toDate: d ? (0, P.RQ)(d) : "", pod: e, container: t }; return k((t => ({ ...t, [e]: u }))), o }), [r, y, a, k]), I = (0, l.useCallback)((async () => { await Promise.allSettled(f.map((async e => { const t = (0, x.Qt)(i, v[e]); await N({ pod: e, container: t }) }))) }), [N, i, v, f]); (0, l.useEffect)((() => { f.length && I() }), [y, I, f, b]); const D = Object.entries(A).sort((([e], [t]) => (0, $.n)(e.replace(`${n}-`, ""), t.replace(`${n}-`, "")))), F = m ? Fe(C.ui, { style: { height: 350 } }, void 0, Ae || (Ae = Fe(d.A, {}))) : Fe("div", {}, void 0, Fe(C.lU, {}, void 0, Fe("p", {}, void 0, "以下为汇总所有节点最新(", y, "行)日志"), ke || (ke = Fe(V.A.FlexFit, {})), Fe(te.A, { onClick: () => I() })), Se || (Se = Fe(V.A.Vertical, { factor: 5, base: 4 })), D.map((([e, t]) => { var o; return Fe($e, { style: { marginBottom: 20 }, id: (0, x.Sb)(t.pod, null === (o = v[t.pod]) || void 0 === o ? void 0 : o.ip), log: t, height: y > 10 ? 380 : "auto", showTimeRange: !1 }, e) })), 0 === D.length && Fe(C.ui, { style: { height: 350 } }, void 0, "暂无数据")); return Fe(C.R, { height: o ? "100%" : "calc(100vh - 173px)" }, void 0, Fe("div", { className: S.A["select-container"] }, void 0, Fe(De.A, { onFinish: ({ count: e }) => { h(e), g(Date.now()) }, layout: "inline", initialValues: { count: "10" } }, void 0, Fe(De.A.Item, { label: "展示最近条数", name: "count", rules: [{ pattern: new RegExp(/^[1-9]\d*$/), message: "必须是正整数" }] }, void 0, Fe(O.A, { style: { width: 100 }, options: [{ label: "100", value: "100" }, { label: "50", value: "50" }, { label: "10", value: "10" }] })), Fe(De.A.Item, {}, void 0, Fe(Q.A, { htmlType: "submit", type: "primary", loading: m }, void 0, "查询"))), Fe("div", { style: { display: "inline-flex", flex: 1 } }), Fe(Q.A, { type: "text", flexCenter: !0, icon: Ne || (Ne = Fe(X.A, {})), onClick: e, style: { marginTop: 4, justifyContent: "flex-end" } }, void 0, "全屏")), Ie || (Ie = Fe(V.A.Vertical, { factor: 5, base: 4 })), o ? Fe(z.A, { fullScreen: !0, open: !0, onCancel: t, footer: null }, void 0, Fe("div", { style: { padding: 20 } }, void 0, F)) : F) } xe.displayName = "LogDiff"; var je, Te, Re = xe; function Ue(e, t, o, l) { Te || (Te = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Te, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } function Me() { const [e, { on: t, off: o }] = (0, A.Cg)(!1), n = (0, k.U)(), a = (0, l.useCallback)((e => { let t = "节点日志"; switch (e) { case "0": t = "节点日志"; break; case "1": t = "日志汇聚"; break; case "2": t = "历史日志" }n.tasks.openTaskLog(t) }), [n]); return Ue(i.A, { className: S.A["task-log-root"] }, void 0, Ue(i.A.Content, { tabsContent: !0 }, void 0, Ue(g.A, { defaultActiveKey: "0", onChange: a }, void 0, Ue(g.A.TabPane, { tab: "节点日志" }, "0", Ue(Pe, { fullScreen: e, openFullScreen: t, closeFullScreen: o })), Ue(g.A.TabPane, { tab: "日志汇聚" }, "1", Ue(Re, { fullScreen: e, openFullScreen: t, closeFullScreen: o })), je || (je = Ue(g.A.TabPane, { tab: "历史日志" }, "2", Ue(H, {})))))) } Me.displayName = "TaskLogLayout"; var Oe, qe = Me, Le = o(53347), Ee = (o(39261), o(83700), o(83632), o(51579), o(26236), o(81913), o(31990), o(94729), o(4390), o(14399), o(88269), o(14277), o(33951), o(8199), o(79819)), Be = o(10759), Ke = o(66125), _e = o(24620), He = o(12397), Je = o(79631), We = o(57163); function Ye(e, t, o, l) { Oe || (Oe = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Oe, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const Ge = (0, Le.A)("div", { target: "emde9130", label: "WebShellContainer" })({ name: "1h6dpba", styles: "width:calc(100vw - 260px);box-sizing:border-box;padding:10px 30px" }); function Qe(e) { const t = window.TextEncoder ? new TextEncoder : null; if (t) return t.encode(e); const o = encodeURIComponent(e).split("").map((e => e.charCodeAt(0))); return new Uint8Array(o) } function Ve() { var e; const { clusterUuid: t, k8sNamespace: o, k8sName: n, kind: a, podName: i, queueID: r } = (0, c.I)(), d = (0, l.useRef)(""), s = (0, l.useRef)(), u = (0, l.useRef)(null), v = (0, l.useRef)(0), [m, f] = (0, l.useState)(1), [y, h] = T({ k8sName: n, k8sNamespace: o, kind: a, clusterUuid: t, queueID: r }), [b, g] = (0, l.useState)((null == y || null === (e = y[0]) || void 0 === e ? void 0 : e.value) || i), A = (0, We.C)(), k = () => { var e; null === (e = u.current) || void 0 === e || e.dispose() }, S = (e, t) => { var o; clearInterval(v.current), null === (o = s.current) || void 0 === o || o.close(e, t) }, N = () => { f(1) }, I = e => { var t, o; s.current && s.current.readyState === WebSocket.OPEN ? null === (t = s.current) || void 0 === t || t.send(e) : console.error("WebSocket还没有建立连接. 当前状态: " + (null === (o = s.current) || void 0 === o ? void 0 : o.readyState)) }, C = (0, l.useCallback)((e => { S(e), k(), oe.A.error(`websocket服务端错误码${e}`) }), []), P = (0, l.useCallback)((() => { var e; null === (e = u.current) || void 0 === e || e.setup(); const t = `wss://${A}/api/v1/containerwebshell/establish/${d.current}`; try { s.current = new WebSocket(t), s.current.binaryType = "arraybuffer" } catch (e) { var o; null === (o = u.current) || void 0 === o || o.writeln(`Connect Fail ${e}`) } s.current && (s.current.onopen = () => { var e; null === (e = u.current) || void 0 === e || e.writeln("Connect Success"), v.current = window.setInterval((() => { I(Qe("\0\0\0")) }), 3e4), f(-1), $() }, s.current.onmessage = e => { var t; if ("string" == typeof e.data) null === (t = u.current) || void 0 === t || t.terminalRef.write((0, Je.h)(e.data.toString())); else if ("object" == typeof e.data && e.data instanceof ArrayBuffer) { var o; const t = new TextDecoder("utf-8").decode(new Uint8Array(e.data)); null === (o = u.current) || void 0 === o || o.terminalRef.write((0, Je.h)(t.toString())) } }, s.current.onclose = () => { clearInterval(v.current), N() }, s.current.onerror = ({ code: e }) => { N(), C(e) }) }), [C, A]), D = (0, l.useCallback)((async () => { if (!o || !b) return; const e = (0, x.Qt)(a, h[b]), l = { clusterUuid: t, podName: b, containerName: e, commandType: "bash", namespace: o, queueID: r }; k(), f(0); const { result: n, message: i, success: s } = await p.ikU(l); if (s) return d.current = n.token, void P(); var c, v, m; N(), c = i.global, null === (v = u.current) || void 0 === v || v.setup(), null === (m = u.current) || void 0 === m || m.writeln(c) }), [t, b, o, a, h, r, P]), w = (0, l.useCallback)((e => { I(Qe(`\0${e}`)) }), []), F = (0, l.useCallback)((() => { 0 !== m && (-1 !== m ? D() : S()) }), [D, m]); (0, l.useEffect)((() => { h[b] && F() }), [b, h]); const $ = () => { var e; null === (e = u.current) || void 0 === e || e.resize(I) }; return (0, l.useLayoutEffect)((() => { u.current && s.current && window.addEventListener("resize", (() => $()), !1) }), [u.current, s.current]), (0, q.FD)(q.FK, { children: [Ye(Ke.Ay, { title: "WebShell" }, void 0, Ye(Ee.A, { gutter: 8 }, void 0, Ye(Be.A, {}, void 0, Ye("span", { style: { marginRight: 10 } }, void 0, "实例名称:"), Ye(O.A, { style: { minWidth: 300 }, options: y, value: b, onChange: g })), Ye(Be.A, {}, void 0, Ye(_e.A.Tasks.OpenWebShell, {}, void 0, Ye(Q.A, { onClick: F, type: "primary", disabled: 0 === m }, void 0, 0 === m ? "正在连接..." : "连接")), Ye("span", { style: { marginLeft: 10 } }, void 0, "指令类型默认/bin/bash")))), Ye(Ge, {}, void 0, (0, q.Y)(He.A, { onChange: w, ref: u, onFullScreen: $ }))] }) } Ve.displayName = "WebShell"; var ze, Ze = o(82015), Xe = o(48095), et = o(8868), tt = o(60397), ot = o(54863), lt = o(82779); function nt(e, t, o, l) { ze || (ze = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: ze, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const at = [{ name: "type", label: "事件类型", props: { placeholder: "请选择事件类型", options: tt._D } }, { name: "objectKinds", label: "资源类型", props: { placeholder: "默认为全部类型", mode: "multiple", options: [{ label: "Job", value: "Job" }, { label: "Pod", value: "Pod" }, { label: "PodGroup", value: "PodGroup" }, { label: "Service", value: "Service" }, { label: "Node", value: "Node" }] } }, { name: "quickSelect", label: "快捷筛选", props: { placeholder: "请选择快捷类型", options: [{ label: "全部", value: "all" }, { label: "Pod异常事件", value: "PodWarning" }, { label: "节点异常事件", value: "NodeWarning" }] } }], it = ({ onFilterChange: e, initialValues: t, ...o }) => (0, q.Y)(ot.Ay, { onChange: e, initialValues: t, ...o, children: nt(lt.A, { gap: 10, align: "center" }, void 0, at.map((({ props: e, ...t }) => (0, q.Y)(ot.Ay.Field, { initialValue: t.defaultValue, ...t, children: (0, q.Y)(ot.Ay.Select, { style: { width: 180 }, ...e }) }, t.name)))) }); var rt; function dt(e, t, o, l) { rt || (rt = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: rt, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const st = [{ name: "message", renderType: "search", defaultValue: "", props: { allowClear: !0, placeholder: "请输入关键字搜索信息", style: { width: 240 } } }], ut = [{ title: "首次出现时间", dataIndex: "firstTimestamp", width: 160, render: e => (0, I.A)(e).format("YYYY-MM-DD HH:mm:ss") }, { title: "最后出现时间", dataIndex: "lastTimestamp", width: 160, render: e => (0, I.A)(e).format("YYYY-MM-DD HH:mm:ss") }, { title: "事件类型", width: 100, dataIndex: "type", renderType: "stateTag", filters: [{ text: "全部状态", value: "" }, { text: "Normal", value: "Normal", state: "success" }, { text: "Warning", value: "Warning", state: "error" }] }, { title: "资源类型", width: 100, dataIndex: ["involvedObject", "kind"], filterType: "single", filters: [{ text: "全部状态", value: "" }, { text: "Job", value: "Job" }, { text: "Pod", value: "Pod" }, { text: "PodGroup", value: "PodGroup" }, { text: "Service", value: "Service" }, { text: "Node", value: "Node" }], onFilter(e) { return e || !0 } }, { title: "资源名称", dataIndex: ["involvedObject", "name"], width: 180 }, { title: "原因", dataIndex: "reason" }, { title: "消息", dataIndex: "message" }, { title: "处理次数", dataIndex: "count", width: 70 }], ct = (e, { setFieldState: t }) => { e.onFieldValueChange("quickSelect", (e => { "PodWarning" === e.value && (t("type", (e => { e.value = "Warning" })), t("objectKinds", (e => { e.value = ["Pod"] }))), "NodeWarning" === e.value && (t("type", (e => { e.value = "Warning" })), t("objectKinds", (e => { e.value = ["Node"] }))), "all" === e.value && (t("type", (e => { e.value = "" })), t("objectKinds", (e => { e.value = [] }))) })) }; function vt() { var e; const [t, o] = (0, l.useState)(!1), n = (0, l.useRef)((() => { })), a = (0, l.useRef)(), { filterByKinds: i, filterByType: r } = (0, Xe.I)(), [d, s] = (0, l.useState)({ type: null != r ? r : "Warning", objectKinds: i ? [i] : [], quickSelect: "all" }), u = (0, l.useMemo)((() => [{ render() { return e || (e = dt(it, { onFilterChange: s, initialValues: d, effects: ct })) } }]), []), c = (0, et.T)(p.AuV, 1e3), v = (0, l.useCallback)((() => { o(!1), clearInterval(a.current) }), []), m = (0, l.useCallback)((async e => { var t; let o = []; const { clusterUuid: l, pageNo: n, pageSize: a, message: i, name: r, kind: s, k8sNamespace: u, queueID: p } = e, { type: m, objectKinds: f } = d, y = { clusterUuid: l, pageNo: n, pageSize: a, message: i || "", namespace: u, job: r, kind: s, queueID: p, type: (0, tt.bF)(m) ? "" : m, ...null != f && f.length ? { objectKinds: f.join(",") } : {} }, h = await c(y); var b; return h && h.success ? o = (null === (b = h.result) || void 0 === b ? void 0 : b.events) || [] : v(), { totalCount: (null == h || null === (t = h.result) || void 0 === t ? void 0 : t.total) || 0, data: o } }), [c, d, v]); (0, l.useEffect)((() => (t || clearInterval(a.current), a.current = setInterval((() => { t && n.current() }), 1e4), () => clearInterval(a.current))), [t]); const f = (0, l.useMemo)((() => [{ renderType: "refresh" }, { name: "region", render(e, { refresh: l }) { return n.current = l, dt(G.A, { onChange: e => { o(e.target.checked) }, checked: t }, void 0, "开启自动刷新") } }]), [t]); return dt(Ke.Ay, {}, void 0, dt(Ze.A, { columns: ut, operations: u, filters: st, tools: f, request: m, requestConfig: { pageByServer: !0, filterByServer: !0, columnFilterByServer: !0, totalKey: "totalCount" } })) } vt.displayName = "Event"; var pt, mt, ft, yt, ht, bt, gt = o(75386), At = o(82116), kt = o(40793), St = o(10031), Nt = o(4256), It = o(65560), Ct = o(36037), Pt = o(49431), Dt = o(28250), wt = o(31063), Ft = o(81892), $t = o(26768), xt = o(65182), jt = o(26602), Tt = o(77417), Rt = o(34373), Ut = o(85923); function Mt(e, t, o, l) { bt || (bt = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: bt, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const Ot = { Abnormal: "var(--color-error-6)", Failed: "var(--color-error-6)", ManualTermination: "var(--color-gray-6)" }, qt = jt.Ay.div`
    display: flex;
    border: 1px solid var(--color-gray-4);
    border-radius: var(--border-radius-4);
    padding: 24px;
    overflow-x: scroll;
`, Lt = jt.Ay.div`
    /* 结束态时 自适应拉伸 */
    flex: ${e => e.isend ? e.isenditem ? "none" : "auto" : "initial"};
    position: relative;
    /* 最小宽度 */
    min-width: ${e => e.isenditem ? "auto" : "110px"};
    .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-bottom: 16px;
        background-color: ${e => { var t; return null !== (t = Ot[e.conditiontype]) && void 0 !== t ? t : "var(--color-success-6)" }};
    }
    .content {
        .title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        .time {
            white-space: pre-wrap;
            color: var(--color-gray-7);
        }
    }
    .duration {
        position: absolute;
        top: 4px;
        left: 8px;
        display: flex;
        align-items: center;
        width: calc(100% - 8px);
        height: 1px;
        .anticon-loading {
            color: var(--theme-primary-color);
        }
        .line {
            height: 100%;
            background-color: var(--color-gray-4);
            flex: auto;
        }
        .text {
            color: var(--color-gray-8);
            white-space: pre-wrap;
            text-align: center;
        }
    }
`; function Et({ task: e }) { var t, o; const [n, a] = (0, l.useState)(4e3), { clusterUuid: i, k8sName: d, k8sNamespace: s, k8sUid: u, queueID: v } = (0, c.I)(), m = (0, l.useMemo)((() => `jobPerformance-${i}-${d}-${u}-${Math.random()}`), [i, d, u]), f = y(p.G3C), { data: h, mutate: b } = (0, r.Ay)(m, (() => f({ clusterUuid: i, queueID: v }, { data: { jobID: d, jobNamespace: s } })), { refreshInterval: n }); return (0, l.useEffect)((() => { var e; h && null != h && null !== (e = h.result) && void 0 !== e && e.finalState && a(0) }), [h]), null != h && null !== (t = h.result) && void 0 !== t && t.timeline ? Mt(Ke.Ay, { title: "任务统计" }, void 0, Mt(Ee.A, { gutter: [16, 16] }, void 0, Mt(Be.A, { span: 24 }, void 0, Mt(qt, {}, void 0, null == h || null === (o = h.result) || void 0 === o ? void 0 : o.timeline.map(((t, o) => { var l, n, a, r, u, c, p, m, f, y, g, A, k, S, N, C, D, w; const F = (null == h || null === (l = h.result) || void 0 === l ? void 0 : l.finalState) && o === (null == h || null === (n = h.result) || void 0 === n ? void 0 : n.timeline.length) - 1; return Mt(Lt, { isenditem: F ? 1 : 0, isend: null != h && null !== (a = h.result) && void 0 !== a && a.finalState ? 1 : 0, conditiontype: t.conditionType }, t.time, pt || (pt = Mt("div", { className: "dot" })), Mt("div", { className: "content" }, void 0, Mt(W.A, {}, void 0, Mt("div", { className: "title" }, void 0, t.conditionMessage), Mt(Rt.Ph, { faultTolerance: !(null == e || null === (r = e.jobDetail) || void 0 === r || !r.faultTolerance), status: t.conditionType, iconStyle: { marginBottom: 7, color: "orange" } }), Mt(Rt.DC, { status: t.conditionType, iconStyle: { marginBottom: 7, color: "orange" }, stoppedUserId: null == e || null === (u = e.jobDetail) || void 0 === u || null === (c = u.labels) || void 0 === c ? void 0 : c["aijob.cce.baidubce.com/ai-user-stopid"], stoppedUserName: null == e || null === (p = e.jobDetail) || void 0 === p || null === (m = p.labels) || void 0 === m ? void 0 : m["aijob.cce.baidubce.com/ai-user-stopname"] }), Mt(Rt.qk, { status: t.conditionType, iconStyle: { marginBottom: 7, color: "orange" }, timeout: "timeout" === (null == e || null === (f = e.jobDetail) || void 0 === f || null === (y = f.annotations) || void 0 === y ? void 0 : y["job-manager/action-failed"]) }), "Created" === t.conditionType && (null == e || null === (g = e.jobDetail) || void 0 === g || null === (A = g.annotations) || void 0 === A ? void 0 : A["aijob.cce.baidubce.com/submit-time"]) && "ToBeSubmitted" === (null == e || null === (k = e.jobDetail) || void 0 === k ? void 0 : k.status) && Mt(Ut.K, { clusterId: i, k8sName: d, k8sNamespace: s, kind: null == e || null === (S = e.jobDetail) || void 0 === S ? void 0 : S.kind, queueID: v, submitTime: null == e || null === (N = e.jobDetail) || void 0 === N || null === (C = N.annotations) || void 0 === C ? void 0 : C["aijob.cce.baidubce.com/submit-time"], iconStyle: { marginBottom: 7, color: "orange" }, refresh: b })), Mt("div", { className: "time" }, void 0, I.A.unix(t.time).format("YYYY-MM-DD HH:mm:ss").replace(" ", "\n"))), F || Mt("div", { className: "duration" }, void 0, mt || (mt = Mt("div", { className: "line" })), o === (null == h || null === (D = h.result) || void 0 === D ? void 0 : D.timeline.length) - 1 ? ft || (ft = Mt(Tt.A, {})) : (0, q.FD)(q.FK, { children: [Mt("div", { className: "text" }, void 0, (0, P.nO)((null == h || null === (w = h.result) || void 0 === w ? void 0 : w.timeline[o + 1].time) - t.time).replace("小时", "小时\n")), yt || (yt = Mt("div", { className: "line" }))] }))) })))))) : ht || (ht = (0, q.Y)(q.FK, {})) } Et.displayName = "Statistics", o(88856); var Bt, Kt = o(62439); function _t(e, t, o, l) { Bt || (Bt = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Bt, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const Ht = jt.Ay.div`
    white-space: pre-wrap;
`, Jt = [{ title: "告警策略", width: 300, dataIndex: "policy", key: "policy", render: e => _t(Ht, {}, void 0, e) }, { title: "通知渠道", dataIndex: "channel", key: "channel" }, { title: "通知人", dataIndex: "objects", key: "objects", render: e => _t(Ht, {}, void 0, e) }]; function Wt({ alertConfig: e }) { const { clusterUuid: t } = (0, c.I)(), [o, { on: n, off: a }] = (0, A.Cg)(!1), [i, r] = (0, l.useState)(); (0, l.useEffect)((() => { e.notifyRuleId && (0, p.iDv)({ resourcePoolId: t, pageNo: 1, pageSize: 50 }).then((t => { var o; if (Array.isArray(null == t || null === (o = t.result) || void 0 === o ? void 0 : o.items)) { var l; const o = null == t || null === (l = t.result) || void 0 === l ? void 0 : l.items.find((t => t.notifyRuleId === e.notifyRuleId)); r(o) } })) }), [e.notifyRuleId, t]); const d = (0, l.useMemo)((() => { if (e.notifyRuleId && i) { var t, o; const l = e.alertItems.map((e => Kt.wL[e])).join("\n"), { webhookConfigList: n, channel: a, users: r, userGroups: d, receiverType: s } = i, u = null !== (t = null == n ? void 0 : n.map((e => Kt.CU[e.webhookType]))) && void 0 !== t ? t : [], c = a.filter(Boolean).map((e => Kt.Xz[e])), v = Kt.RB[s], p = r.length ? r : d, m = a.filter(Boolean).length ? [`${v}：${null == p ? void 0 : p.map((e => { var t; return null !== (t = e.userName) && void 0 !== t ? t : e.groupName })).join("，")}`] : [], f = null !== (o = null == n ? void 0 : n.map((e => `${Kt.CU[e.webhookType]}：${e.webhookList.map((e => e.hookName)).join("，")}`))) && void 0 !== o ? o : []; return { hasPolicy: !0, config: { policy: l, channel: c.concat(u).join("，"), objects: m.concat(f).join("\n") } } } return { hasPolicy: !1, config: {} } }), [e.alertItems, e.notifyRuleId, i]); return (0, q.FD)(q.FK, { children: [_t(Ke.Ay.Field, { title: "告警配置" }, void 0, _t("span", { className: "margin-right-10" }, void 0, d.hasPolicy ? "已开启" : "--"), d.hasPolicy && _t(Q.A, { onClick: n, type: "link" }, void 0, " 查看配置")), _t(z.A, { width: 800, title: "告警配置", open: o, footer: [_t(Q.A, { onClick: a }, "onOK", "关闭")], onCancel: a }, void 0, _t(gt.A, { columns: Jt, dataSource: [d.config], pagination: !1 }))] }) } Wt.displayName = "AlertConfig"; var Yt, Gt, Qt = o(74208); function Vt(e, t, o, l) { Gt || (Gt = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Gt, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const zt = [{ title: "任务名称", dataIndex: "name", key: "name" }, { title: "状态", key: "status", dataIndex: "status", width: 80, render: e => Vt(v.A8, { status: e }) }, { title: "资源池/队列", key: "queue", render: ({ queue: e, clusterName: t }) => (0, q.FD)(q.FK, { children: [t, "/", e] }) }, { title: "创建人", key: "createdBy", dataIndex: "createdBy", render: (e, t) => { var o; return (null == t || null === (o = t.labels) || void 0 === o ? void 0 : o["aijob.cce.baidubce.com/ai-user-name"]) || "--" } }, { title: "创建时间", render: ({ createdAt: e }) => e ? (0, I.A)(e).format("YYYY-MM-DD HH:mm:ss") : "--" }, { title: "结束时间", render: ({ finishedAt: e }) => e ? (0, P.RQ)(e) : "--" }, { title: "任务耗时", render: ({ createdAt: e, finishedAt: t }) => e && t ? `${(0, P.nO)((0, P.rm)(e, t))}` : Yt || (Yt = (0, q.Y)(q.FK, { children: "--" })) }]; function Zt({ jobDetail: e }) { var t, o, n; const a = (0, Qt.Zp)(), { k8sName: i, k8sNamespace: r, kind: d, clusterUuid: s, name: v } = (0, c.I)(), [m, { on: f, off: y }] = (0, A.Cg)(!1), h = null == e ? void 0 : e.queue, [b, { data: g }] = (0, A.aF)(p.vSW, { clusterUuid: s, name: v, kind: d, namespace: r, k8sName: i, queueID: h }); (0, l.useEffect)((() => { b() }), [b, v]); const k = (0, l.useMemo)((() => { var e; const t = null == g || null === (e = g.result) || void 0 === e ? void 0 : e.list; return null != t && t.length && t.forEach((e => { e.clusterName = (0, Ct.Mt)(e.clusterId, e.clusterName) || "" })), g }), [g]); return (0, q.FD)(q.FK, { children: [Vt(Ke.Ay.Field, { title: "任务重跑" }, void 0, "基于任务", Vt(Q.A, { type: "link", onClick: (S = e, async () => { const e = await (0, F.p)({ clusterUuid: S.clusterId, k8sName: S.sourceJobName, kind: S.kind, k8sNamespace: S.k8sNamespace, queueID: h }); if (e && e.jobDetail) { const e = `${u.Ay.task.info.detail.path()}?clusterUuid=${S.clusterId}&k8sNamespace=${S.k8sNamespace}&k8sName=${S.sourceJobName}&kind=${S.kind}&status=${S.status}&name=${S.sourceJobName}&queueID=${h}`; a(e) } }) }, void 0, null == e ? void 0 : e.sourceJobName), "重跑，", (null == k || null === (t = k.result) || void 0 === t ? void 0 : t.total) > 0 && Vt("span", {}, void 0, "已重跑", Vt(Q.A, { type: "link", onClick: f }, void 0, null == k || null === (o = k.result) || void 0 === o ? void 0 : o.total), "次")), Vt(z.A, { width: 1e3, title: "任务重跑记录", open: m, onCancel: y, footer: Vt(Q.A, { onClick: y }, void 0, "关闭") }, void 0, Vt(gt.A, { columns: zt, dataSource: (null == k || null === (n = k.result) || void 0 === n ? void 0 : n.list) || [], pagination: { hideOnSinglePage: !0 } }))] }); var S } Zt.displayName = "ReTrained"; var Xt, eo, to = o(57872), oo = o(37281), lo = o(54148), no = JSON.parse('{"name":"outlined-tree-down","icon":{"type":"element","isRootNode":true,"name":"svg","attributes":{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 1024 1024"},"children":[{"type":"element","name":"path","attributes":{"d":"M512 704L256 384h512z"},"children":[]}]}}'), ao = function () { return ao = Object.assign || function (e) { for (var t, o = 1, l = arguments.length; o < l; o++)for (var n in t = arguments[o]) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]); return e }, ao.apply(this, arguments) }, io = n().forwardRef((function (e, t) { return n().createElement(lo.A, ao({}, e, { svgJson: no, ref: t })) })), ro = o(7484), so = o(44088), uo = o(24270); function co(e, t, o, l) { eo || (eo = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: eo, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } o(72472), o(93276), o(33373), o(31035); const vo = [{ title: "角色", dataIndex: "replicaType", key: "replicaType", width: 96 }, { title: "实例名称/ID", dataIndex: "podName", key: "podName", render: (e, t) => co("div", {}, void 0, co("div", {}, void 0, e), Xt || (Xt = co(V.A.Vertical, { factor: 2, base: 4 })), co("div", {}, void 0, t.uid)) }, { title: "状态", key: "status", minWidth: 60, render: ({ podStatusConfig: e }) => co(to.A, { status: e.value }, void 0, e.text) }, { title: "重启次数", key: "restartCount", dataIndex: "restartCount", minWidth: 70 }, { title: "实例IP", dataIndex: "podIP", key: "podIP", render: e => e || "-" }, { title: "Host IP", dataIndex: "nodeIP", key: "nodeIP" }, { title: "创建时间", key: "createTime", dataIndex: "createTime", render: e => (0, P.RQ)(e) }, { title: "结束时间", key: "finishedAt", dataIndex: "finishedAt", render: e => (0, P.RQ)(e) }, { title: "执行时长", key: "executionSeconds", dataIndex: "executionSeconds", render: e => (0, P.nO)(Math.floor(e)) }, { title: "操作", fixed: "right", width: 110, render: ({ podName: e, isChildren: t }) => t ? null : (0, q.FD)(q.FK, { children: [co(oo.N_, { to: `${u.Ay.task.info.log.path()}${location.search}&podName=${e}` }, void 0, "日志"), co(oo.N_, { style: { marginLeft: 10 }, to: `${u.Ay.task.info.webshell.path()}${location.search}&podName=${e}` }, void 0, "WebShell")] }) }], po = [{ label: "角色", value: "replicaType" }, { label: "实例名称", value: "podName" }, { label: "状态", value: ({ podStatusConfig: e }) => e.text }, { label: "重启次数", value: "restartCount" }, { label: "实例IP", value: "podIP" }, { label: "Host IP", value: "nodeIP" }, { label: "创建时间", value: e => (0, P.RQ)(e.createTime) }]; function mo({ loading: e, dataSource: t, jobName: o, ...n }) { const [a, i] = (0, l.useState)([]), [r, d] = (0, l.useState)([]), s = [{ render(e, t) { const l = t.data.map((e => e.id)); return co(so.A, { selectedRows: (0, w.sortBy)(a, (e => l.indexOf(e.id))), setSelectedRows: i, all: t.data, columns: po, fileName: `${o}-实例信息` }) } }], u = { expandIcon: ({ expanded: e, onExpand: o, record: l }) => { const n = Array.isArray(t) && !!t.find((e => e.children)); return l.children || l.isChildren ? l.isChildren ? co("div", { style: { marginLeft: 12, display: "inline-block" } }) : co("span", { onClick: e => o(l, e) }, void 0, co(e ? io : ro.A, { style: { fontSize: 18, cursor: "pointer" } })) : n ? co("div", { style: { marginLeft: 16, display: "inline-block" } }) : null }, expandedRowKeys: r, onExpandedRowsChange: e => { d(e) } }; return function (e, t) { var o = arguments; if (null == t || !uo.h.call(t, "css")) return l.createElement.apply(void 0, o); var n = o.length, a = new Array(n); a[0] = uo.E, a[1] = (0, uo.c)(e, t); for (var i = 2; i < n; i++)a[i] = o[i]; return l.createElement.apply(null, a) }(Ze.A, { ...n, rowKey: "podName", operations: s, loading: e, columns: vo, dataSource: t, pagination: !1, expandable: u, key: r.join(","), rowSelection: { preserveSelectedRowKeys: !0, onChange(e, t) { i(t) }, selectedRowKeys: a.map((e => e.podName)), columnWidth: 32, renderCell: (e, t, o, l) => t.isChildren ? null : l }, scroll: { x: "max-content" } }) } mo.displayName = "PodListTable"; var fo, yo, ho = o(13838), bo = o(62708), go = o(5791); function Ao(e, t, o, l) { yo || (yo = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: yo, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } function ko({ jobName: e, isCustomDelete: t, retentionPeriod: o, retentionPeriodUnit: n, clusterUuid: a, jobID: i, k8sNamespace: r, kind: d, queueID: s, refresh: u }) { var c; const v = (0, l.useRef)(n), m = (0, l.useCallback)((e => { v.current = e }), []), f = Ao(O.A, { defaultValue: v.current, onChange: m, options: [{ value: "d", label: "天" }, { value: "h", label: "小时" }, { value: "m", label: "分钟" }] }), y = (0, l.useCallback)((async e => { try { const o = await (0, p.VDr)({ clusterUuid: a, jobID: i, queueID: s }, { data: { retentionPeriod: e.isCustomDelete ? e.retentionPeriod + v.current : "", namespace: r, kind: d } }); var t; o.success ? (oe.A.success("修改成功"), u && u()) : oe.A.error(null == o || null === (t = o.message) || void 0 === t ? void 0 : t.global) } catch { oe.A.error("修改失败") } }), [u]), h = (0, l.useCallback)((async () => Promise.resolve({ isCustomDelete: t, retentionPeriod: o })), [t]); return Ao(W.A, {}, void 0, t ? `已开启，保留时长${o}${"d" === v.current ? "天" : "h" === v.current ? "小时" : "分钟"}` : "未开启", Ao(ot.Ay.Modal, { title: "调整配置", trigger: Ao(bo.A, { className: (0, go.AH)({ name: "1a2j01p-CustomDeleteTask", styles: "color:var(--link-color);cursor:pointer;label:CustomDeleteTask;" }) + " hover-display" }), onOk: y }, void 0, (({ actions: t }) => Ao(ot.Ay, { actions: t, asyncInitialValues: h }, void 0, c || (c = Ao(ot.Ay.Field, { label: "任务名称", name: "name" }, void 0, e)), fo || (fo = Ao(ot.Ay.Field, { label: "任务退出后自动删除", name: "isCustomDelete", description: "开启后，仅针对于成功/失败状态的任务生效，您可以自定义配置保留时长" }, void 0, Ao(ho.A, { checkedChildren: "开", unCheckedChildren: "关" }))), Ao(ot.Ay.Data, {}, void 0, (e => e.isCustomDelete ? Ao(ot.Ay.Field, { label: "保留时长", name: "retentionPeriod", required: !0, description: "配置成功/失败退出后的任务保留时长，超过该时长将会被删除", rules: [{ pattern: new RegExp(/^[1-9]\d*$/), message: "必须是正整数" }] }, void 0, Ao(ot.Ay.InputNumber, { step: 1, min: 1, max: 1e4, className: (0, go.AH)({ name: "10q0fml-CustomDeleteTask", styles: "width:160px;label:CustomDeleteTask;" }), addonAfter: f, defaultValue: 30 })) : null)))))) } ko.displayName = "CustomDeleteTask"; var So, No, Io = o(34109); function Co(e, t, o, l) { No || (No = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: No, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } var Po, Do, wo = ({ jobDetail: e }) => { const { enableBccl: t, enableBcclErrorReason: o, enableBcclStatus: l } = e; return (0, q.Y)(q.FK, { children: t ? Co("span", {}, void 0, $t.fX[l], "failed" === l && Co(le.A, { title: o }, void 0, So || (So = Co(Io.A, {})))) : "未开启" }) }; function Fo(e, t, o, l) { Do || (Do = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Do, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const $o = (0, jt.Ay)(Ke.Ay.Field)`
    > .icloud-ui-card-field-title {
        visibility: hidden;
    }
`; function xo({ jobDetail: e }) { const [t, o] = (0, l.useState)(!1); return (0, q.FD)(q.FK, { children: [Fo(Q.A, { type: "link", onClick: () => { o(!0) }, style: { marginLeft: 8 } }, void 0, "查看配置"), Fo(z.A, { title: "容错配置", open: t, onCancel: () => { o(!1) }, footer: null, width: 650 }, void 0, Fo(Ke.Ay.Field, { title: "hang检测" }, void 0, e.enabledHangDetection ? (0, q.FD)(q.FK, { children: [Po || (Po = Fo("span", {}, void 0, "已开启")), Fo("span", { style: { marginLeft: 12, display: "inline-block" } }, void 0, "所有Worker实例的日志在", e.hangDetectionTimeoutMinutes, "分钟内没有更新，则初步判断任务处于hang状态")] }) : "未开启"), Fo(Ke.Ay.Field, { title: "自定义训练异常" }, void 0, Array.isArray(e.customFaultTolerancePattern) && e.customFaultTolerancePattern.length > 0 ? "已开启" : "未开启"), Array.isArray(e.customFaultTolerancePattern) && e.customFaultTolerancePattern.length > 0 && Fo($o, {}, void 0, Fo(Ke.Ay.Field, { title: "日志关键字" }, void 0, e.customFaultTolerancePattern.map((e => Fo("p", {}, e, e))))), Fo(Ke.Ay.Field, { title: "无条件重试" }, void 0, e.unconditionalFaultToleranceLimit > 0 ? "已开启" : "未开启"), e.unconditionalFaultToleranceLimit > 0 && Fo($o, {}, void 0, Fo(Ke.Ay.Field, { title: "无条件重试次数" }, void 0, e.unconditionalFaultToleranceLimit)))] }) } xo.displayName = "FaultToleranceConfig"; var jo, To, Ro, Uo, Mo = xo; function Oo(e, t, o, l) { Uo || (Uo = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Uo, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const qo = e => (0, It.Jb)(e.jobFramework) ? (0, w.get)(e, "jobSpec.Launcher.command", e.command) : (0, w.get)(e, "command"), Lo = [{ title: "存储类型", dataIndex: "type", key: "type" }, { title: "挂载点", dataIndex: "mountPoint", key: "mountPoint", render: e => e || "--" }, { title: "源路径", dataIndex: "localPath", key: "localPath" }, { title: "挂载路径", dataIndex: "localMountPath", key: "localMountPath" }, { title: "读写权限", dataIndex: "readOnly", key: "readOnly", render: e => e ? "只读" : "读写" }]; function Eo() { var e, t, o, n, a, i, r, s, v, p, f, y; const { k8sName: h, k8sNamespace: b, kind: g, clusterUuid: k, queueID: S } = (0, c.I)(), [N, { on: I, off: D }] = (0, A.Cg)(!1), { task: w, pending: F, refresh: $ } = j({ clusterUuid: k, k8sName: h, k8sNamespace: b, kind: g, queueID: S }), { cluster: T } = (0, m.RZ)({ clusterUuid: k }), R = (0, Ft.h)(), U = (0, l.useMemo)((() => { const e = [], t = null == w ? void 0 : w.jobDetail.storagePfs, o = null == w ? void 0 : w.jobDetail.storageCfs, l = null == w ? void 0 : w.jobDetail.storageLocal, n = null == w ? void 0 : w.jobDetail.storageDataSet; return null != t && t.length && t.forEach((t => { var o; e.push({ type: (0, q.FD)(q.FK, { children: ["PFS(", Oo(Nt.A, { style: { fontSize: 12 }, href: `${u.lW}${null == w ? void 0 : w.jobDetail.pfsId}` }, void 0, null == w ? void 0 : w.jobDetail.pfsId), ")"] }), localPath: t.sourcePath, localMountPath: t.mountPath, readOnly: null === (o = t.options) || void 0 === o ? void 0 : o.readOnly }) })), null != o && o.length && o.forEach((t => { var o, l, n, a; e.push({ type: (0, q.FD)(q.FK, { children: ["CFS(", Oo(Nt.A, { style: { fontSize: 12 }, href: `${u.eU}${null == t || null === (o = t.options) || void 0 === o ? void 0 : o.cfsInstanceId}` }, void 0, null == t || null === (l = t.options) || void 0 === l ? void 0 : l.cfsInstanceId), ")"] }), localPath: t.sourcePath, localMountPath: t.mountPath, readOnly: null === (n = t.options) || void 0 === n ? void 0 : n.readOnly, mountPoint: null === (a = t.options) || void 0 === a ? void 0 : a.cfsMountPoint }) })), null != l && l.length && l.forEach((t => { var o; e.push({ type: "本地路径", localPath: t.localPath, localMountPath: t.mountPath, readOnly: null === (o = t.options) || void 0 === o ? void 0 : o.readOnly }) })), null != n && n.length && n.forEach((t => { var o; e.push({ type: "数据集", localPath: t.sourcePath, localMountPath: t.mountPath, readOnly: null === (o = t.options) || void 0 === o ? void 0 : o.readOnly }) })), e }), [w]), M = (0, l.useMemo)((() => { var e, t; return Object.entries(null !== (e = null == w || null === (t = w.jobDetail) || void 0 === t ? void 0 : t.env) && void 0 !== e ? e : []).map((([e, t]) => ({ name: e, value: t }))) }), [null == w || null === (e = w.jobDetail) || void 0 === e ? void 0 : e.env]); if (F || !w) return jo || (jo = Oo(C.ui, {}, void 0, Oo(d.A, {}))); const { podData: O, jobDetail: L } = w, { value: E, unit: B } = (0, x.Ul)(null == L ? void 0 : L.retentionPeriod); return (0, q.FD)(q.FK, { children: [Oo(Et, { task: w }), Oo(Ke.Ay, { title: "基本信息" }, void 0, Oo(Ee.A, { gutter: [0, 16] }, void 0, Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "任务名称" }, void 0, null !== (t = L.name) && void 0 !== t ? t : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "资源池/队列" }, void 0, k ? `${(0, Ct.Mt)(k, null == T ? void 0 : T.clusterName)}/${null !== (o = L.queue) && void 0 !== o ? o : "--"}` : null !== (n = L.queue) && void 0 !== n ? n : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "训练框架" }, void 0, It.pd[L.jobFramework] || L.kind || "")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "创建人" }, void 0, (null == L || null === (a = L.labels) || void 0 === a ? void 0 : a["aijob.cce.baidubce.com/ai-user-name"]) || "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "创建时间" }, void 0, (0, P.RQ)(L.createdAt))), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "结束时间" }, void 0, L.finishedAt ? (0, P.RQ)(L.finishedAt) : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "任务耗时" }, void 0, L.runTime ? (0, P.OU)(L.runTime) : "--")))), Oo(Ke.Ay, { title: "基本配置" }, void 0, Oo(Ee.A, { gutter: [0, 16] }, void 0, Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "加速芯片类型" }, void 0, null !== (i = L.Gpu) && void 0 !== i ? i : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "加速芯片数" }, void 0, L.GpuCount ? L.GpuCount : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "CPU数" }, void 0, L.cpuCount ? L.cpuCount + "核" : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "内存数" }, void 0, (0, x.Y)(L.memoryCount))), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "共享内存数" }, void 0, (0, x.Y)(L.shareMemoryCount))), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "优先级" }, void 0, $t.UP[L.priority] || "中", "Created" === L.status && "AscendJob" !== L.kind || "ToBeSubmitted" === L.status && Oo(xt.d, { record: L, refresh: $ }))), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "日志持久化" }, void 0, "true" === (null === (r = L.env) || void 0 === r ? void 0 : r.LOG_COLLECTION) ? "已开启" : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "RDMA" }, void 0, null !== (s = L.resource) && void 0 !== s && s["rdma/hca"] ? "已开启" : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "容错" }, void 0, L.faultTolerance ? "已开启" : "--", L.faultTolerance && Oo(Mo, { jobDetail: L }))), Oo(Be.A, { span: 8 }, void 0, Oo(Wt, { alertConfig: L.alertConfig || {} })), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "镜像地址" }, void 0, L.image ? L.image + (L.tag ? ":" + L.tag : "") : "--")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "使用BCCL通信库" }, void 0, Oo(wo, { jobDetail: L }))), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "RDMA高精度监控" }, void 0, L.annotations.highPrecisionMetrics ? "已开启" : "已关闭")), Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "容器网络类型" }, void 0, void 0 === L.hostNetwork ? "--" : L.hostNetwork ? "物理网络" : "容器网络")), (0, It.OU)(L.jobFramework) && Oo(Be.A, { span: 8 }, void 0, Oo(Ke.Ay.Field, { title: "任务退出后自动删除" }, void 0, Oo(ko, { jobName: null !== (v = L.name) && void 0 !== v ? v : "--", isCustomDelete: null !== (p = "" !== (null == L ? void 0 : L.retentionPeriod)) && void 0 !== p && p, retentionPeriod: E, retentionPeriodUnit: B, clusterUuid: L.clusterId, jobID: L.name, k8sNamespace: b, kind: g, queueID: L.queue, refresh: $ }))), !!L.sourceJobName && Oo(Be.A, { span: 8 }, void 0, Oo(Zt, { jobDetail: L })), Oo(Be.A, { span: 24 }, void 0, Oo(Ke.Ay.Field, { title: "环境变量" }, void 0, M.length ? Oo(gt.A, { pagination: { hideOnSinglePage: !0, pageSize: 5, total: M.length, showQuickJumper: !1 }, style: { width: 700 }, columns: [{ title: "变量名", dataIndex: "name", key: "name" }, { title: "变量值", dataIndex: "value", key: "value" }], dataSource: M }) : "--")), Oo(Be.A, { span: 24 }, void 0, Oo(Ke.Ay.Field, { title: "数据源" }, void 0, U.length ? Oo(gt.A, { style: { width: 700 }, columns: Lo, dataSource: U, pagination: !1 }) : "--")), Oo(Be.A, { span: 24 }, void 0, Oo(Ke.Ay.Field, { title: "执行命令" }, void 0, qo(L) ? (0, q.FD)(q.FK, { children: [Oo(Q.A, { onClick: N ? D : I, type: "link" }, void 0, N ? To || (To = (0, q.FD)(q.FK, { children: ["收起", Oo(At.A, {})] })) : Ro || (Ro = (0, q.FD)(q.FK, { children: ["展开", Oo(kt.A, {})] }))), Oo(St.T, { height: N ? "500px" : "60px", width: "700px", value: qo(L), language: "shell", theme: "vs-dark", options: { readOnly: !0 }, hasCopy: !0 })] }) : "--")), (0, wt.v)(Dt.t.PAGE_SHOW_TASK_RESOURCE_CODE_UPLOADER, { featureFlags: R }) && Oo(Be.A, { span: 24 }, void 0, Oo(Ke.Ay.Field, { title: "源代码" }, void 0, Oo(gt.A, { columns: [{ title: "代码文件", dataIndex: "name", render: () => { var e; return null != L && null !== (e = L.codeSource) && void 0 !== e && e.filePath ? Oo(Q.A, { type: "link", onClick: async () => { var e; const t = await (0, Pt.wp)({ clusterID: k, queueID: null == L ? void 0 : L.queue, filePath: null == L || null === (e = L.codeSource) || void 0 === e ? void 0 : e.filePath.split("/").join("-") }); if (Array.isArray(t.result)) { const e = t.result[0], o = document.createElement("a"); o.href = e.replace(/^http:/, "https:"), o.download = "源代码.zip", document.body.appendChild(o), o.click(), document.body.removeChild(o) } } }, void 0, "下载") : "--" } }, { title: "挂载路径", dataIndex: "path", key: "path" }], dataSource: [{ name: null == L || null === (f = L.codeSource) || void 0 === f ? void 0 : f.filePath, path: null == L || null === (y = L.codeSource) || void 0 === y ? void 0 : y.mountPath }] }))))), Oo(Ke.Ay, { title: "实例信息" }, void 0, Oo(mo, { tools: [{ render: () => Oo(te.A, { onClick: () => $() }) }], loading: F, dataSource: O, pagination: !1, jobName: h }))] }) } Eo.displayName = "Detail", o(9582); var Bo, Ko, _o, Ho, Jo = o(27268), Wo = o(75903), Yo = o(56459), Go = o(51410), Qo = o(64010), Vo = o(79951); function zo(e, t, o, l) { Ho || (Ho = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: Ho, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } function Zo() { var e; const { clusterUuid: t, name: o, k8sName: n, k8sNamespace: a, kind: i, queueID: r } = (0, c.I)(), [u, v] = (0, l.useState)([]), [p, f] = (0, l.useState)(""), [y, h] = (0, l.useState)({}), [A, k] = (0, l.useState)([]), [S, N] = (0, l.useState)(""), [P, D] = (0, l.useState)(""), { task: w } = j({ clusterUuid: t, k8sName: n, k8sNamespace: a, kind: i, queueID: r }), F = (0, s.UH)(), [$, x] = (0, l.useState)(!0), T = (0, l.useMemo)((() => { var e, t; return (null == w || null === (e = w.jobDetail) || void 0 === e ? void 0 : e.finishedAt) ? 1e3 * (0, I.A)(null == w || null === (t = w.jobDetail) || void 0 === t ? void 0 : t.createdAt).unix() : "now-30m" }), [w]), R = (0, l.useMemo)((() => { var e; const t = null == w || null === (e = w.jobDetail) || void 0 === e ? void 0 : e.finishedAt; return t ? 1e3 * (0, I.A)(t).unix() : "now" }), [w]), [U, M] = (0, l.useState)(void 0), O = (0, m.RZ)({ clusterUuid: t }); (0, l.useEffect)((() => { var e; M((null === (e = O.cluster) || void 0 === e ? void 0 : e.aihcpResourceType) || "nvidia") }), [null === (e = O.cluster) || void 0 === e ? void 0 : e.aihcpResourceType, t, M]); const [L, E] = (0, l.useState)(!1), B = (0, l.useCallback)((async () => { var e, o, l; if (!w || !U) return; let n = ""; var a, i, d; if ((0, b.B)(w.jobDetail.labels) ? n = "BAIGE-MIX-JOB" : "ascend" === U ? n = "BAIGE-ASCEND-JOB" : "nvidia" === U && (n = (a = w) && (null === (d = Object.keys(null !== (i = a.jobDetail.resource) && void 0 !== i ? i : {}).find((e => (0, Go.K)(e)))) || void 0 === d ? void 0 : d.length) ? "BAIGE-KUNLUN-JOB" : "BAIGE-JOB"), (0, Ct.Rs)(t) && (n = "AIHC-SERVERLESS-JOB"), (0, Ct.RR)(t) && (n = "AIHC-BHCMP-JOB"), (0, Vo.s)(null == w || null === (e = w.jobDetail) || void 0 === e ? void 0 : e.podList) && (n = "AIHC-JOB-SGPU"), !n) return; x(!0); const s = await (0, Pt.Hi)({ clusterID: t, tag: n, queueID: r }), u = null == w || null === (o = w.jobDetail) || void 0 === o || null === (l = o.annotations) || void 0 === l ? void 0 : l.highPrecisionMetrics; x(!1), s && void 0 !== s.length ? (v((s || []).filter((e => !e.folderTitle.includes("高精度监控") || !!u)).map((e => ({ ...e, dashboards: e.dashboards.filter((e => !u || !e.folderTitle.includes("高精度监控") || u.split(",").some((t => e.tags.includes(t))))) })))), s[0] && (f(s[0].folderTitle), k(s[0].dashboards.map((e => ({ ...e, label: e.title, value: e.title })))), N(s[0].dashboards[0].title))) : E(!0) }), [U, t, r, w]), K = (0, l.useCallback)((e => { const t = null == A ? void 0 : A.find((t => t.title === e)); if (t) { const e = t.url, n = JSON.parse(JSON.stringify(y || {})); var l; n.theme = "light", n["var-job"] = o, n["var-namespace"] = a, n.from = T, n.to = R, p.includes("高精度监控") && (n["var-JOB_UID"] = (null == w || null === (l = w.jobDetail) || void 0 === l ? void 0 : l.k8sUid) || "", delete n["var-datasource"]); const i = Object.entries(n).map((e => `${e[0]}=${e[1]}`)).join("&"); D(`${e}?${i}`) } else D("") }), [A, y, o, a, T, R, p, w]), _ = (0, l.useCallback)((e => { N(e.target.value), F.tasks.openTaskMonitor(e.target.value) }), [F.tasks]); (0, l.useEffect)((() => { K(S) }), [S, K]), (0, l.useEffect)((() => { B() }), [B]), (0, l.useEffect)((() => { if (0 === u.length || !p) return; const e = u.find((e => e.folderTitle === p)), t = null == e ? void 0 : e.dashboards.map((e => ({ ...e, label: e.title, value: e.title }))); k(t || []), h((null == e ? void 0 : e.vars) || {}), (null == t ? void 0 : t[0]) && N(t[0].title) }), [p, u]), ((e, t) => { const { cpromID: o } = (0, Qo.f)({ clusterID: e, queueId: t }); (0, l.useEffect)((() => { if (o) { if ((0, Ct.Rs)(e)) return; (0, Pt.Sh)({ cpromID: o }) } }), [e, o]) })(t, r); const H = (0, l.useRef)(null); (0, Wo.y)({ iframeRef: H }); const [J, W] = (0, l.useState)(!1); return L ? zo(Ke.Ay, { className: (0, go.AH)({ name: "1p4nma9-PerformanceMonitor", styles: "height:100%;label:PerformanceMonitor;" }) }, void 0, "获取资源失败") : $ ? zo(C.ui, { style: { height: 200 } }, void 0, Bo || (Bo = zo(d.A, {}))) : zo(g.A, { style: { minHeight: 200 }, onChange: e => f(e) }, void 0, u.map((e => zo(g.A.TabPane, { tab: e.folderTitle }, e.folderTitle, zo(Yo.A, { fullScreenStyle: { background: "#fff" }, style: { background: "#fff" }, width: "calc(100vw - 220px)", triggerStyle: { color: "#000", marginTop: "10px", fontSize: "16px", right: "30px" }, onChange: W }, void 0, zo(Jo.A.Group, { style: { padding: "20px 20px 0 20px" }, options: A, value: S, onChange: _ }), (0, q.Y)("iframe", { ref: H, id: "cprom-monitor-iframe", height: window.innerHeight - (J ? 100 : 230) + "px", width: "100%", src: P })))))) } function Xo() { const e = (0, c.o)(); return e.loader ? e.loader : e.isOpened ? zo(i.A, { className: S.A["task-log-root"] }, void 0, zo(i.A.Content, { className: (0, go.AH)({ name: "n62xy3-Monitor", styles: "background:#fff;label:Monitor;" }), tabsContent: !0 }, void 0, _o || (_o = zo(Zo, {})))) : Ko || (Ko = (0, q.Y)(q.FK, { children: "未关联监控实例，请在资源池详情关联监控实例" })) } Zo.displayName = "PerformanceMonitor", Xo.displayName = "Monitor"; var el, tl = o(14118), ol = o(32838); function ll(e, t, o, l) { el || (el = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: el, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const nl = { display: "flex" }; function al({ record: e }) { const t = (0, Qt.Zp)(), o = (e, t) => `?clusterUuid=${e.clusterId}&k8sNamespace=${e.k8sNamespace}&k8sName=${null != t ? t : e.k8sName}&kind=${e.kind}&status=${e.status}&name=${e.name}&queueID=${e.queue}`, l = () => t(u.Ay.task.info.detail.path() + o(e)), n = (0, tl.T)(); return ll("div", { style: nl }, void 0, ll(W.A, {}, void 0, ll(_e.A.Tasks.CopyTask, {}, void 0, ll(ol.B2, { type: "default", record: e }, void 0, "复制")), "AscendJob" !== e.kind && ll(_e.A.Tasks.StopTask, {}, void 0, ll(ol.Sk, { record: e, refresh: l })), (0, wt.v)(wt.t.PAGE_SHOW_TASK_FORM_TENSORBOARD, { jobKind: e.kind, resourcePoolType: e.cluster, region: n }) && ll(_e.A.Tasks.OpenTensorboard, {}, void 0, ll(ol.We, { record: e })), "AscendJob" !== e.kind && ll(_e.A.Tasks.RetrainTask, {}, void 0, ll(ol.j8, { record: e, refresh: l, toDetail: l => { t(u.Ay.task.info.detail.path() + o(e, l)) } })), ll(_e.A.Tasks.DeleteTask, {}, void 0, ll(ol.Hw, { record: e, callback: () => t(u.Ay.task.list.path()) })))) } al.displayName = "ColumnOperation"; var il, rl, dl, sl, ul = o(75300); function cl(e, t, o, l) { sl || (sl = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: sl, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } const vl = [{ title: "存储类型", dataIndex: "type", key: "type" }, { title: "源路径", dataIndex: "localPath", key: "localPath" }, { title: "挂载路径", dataIndex: "localMountPath", key: "localMountPath" }], pl = ({ jobDetail: e, type: t }) => { var o, l, n, a, i, r, d; const [s, { on: u, off: c }] = (0, A.Cg)(!1), v = null == e || null === (o = e.heteroReplicaSpecs) || void 0 === o ? void 0 : o[t], [p, m] = Object.entries(null == v ? void 0 : v.resources.limits)[0], f = null == v ? void 0 : v.replicas; return cl(Ee.A, { gutter: [0, 16] }, void 0, cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "加速芯片数" }, void 0, Number(m) * f || "--")), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "镜像地址" }, void 0, null !== (l = v.image) && void 0 !== l ? l : "--")), cl(Be.A, { span: 24 }, void 0, cl(Ke.Ay.Field, { title: "执行命令" }, void 0, null !== (n = v.command) && void 0 !== n && n[2] ? (0, q.FD)(q.FK, { children: [cl(Q.A, { onClick: s ? c : u, type: "link" }, void 0, s ? il || (il = (0, q.FD)(q.FK, { children: ["收起", cl(At.A, {})] })) : rl || (rl = (0, q.FD)(q.FK, { children: ["展开", cl(kt.A, {})] }))), cl(St.T, { height: s ? "500px" : "60px", width: "700px", value: null === (a = v.command) || void 0 === a ? void 0 : a[2], language: "shell", theme: "vs-dark", options: { readOnly: !0 }, hasCopy: !0 })] }) : "--")), cl(Be.A, { span: 24 }, void 0, cl(Ke.Ay.Field, { title: "环境变量" }, void 0, null != e && null !== (i = e.heteroReplicaSpecs) && void 0 !== i && null !== (r = i[t].env) && void 0 !== r && r.length ? cl(gt.A, { pagination: !1, style: { width: 700 }, columns: [{ title: "变量名", dataIndex: "name", key: "name" }, { title: "变量值", dataIndex: "value", key: "value" }], dataSource: null == e || null === (d = e.heteroReplicaSpecs) || void 0 === d ? void 0 : d[t].env }) : "--"))) }; function ml() { var e, t, o, n; const { k8sName: a, k8sNamespace: i, kind: r, clusterUuid: s, queueID: v } = (0, c.I)(), { task: p, pending: f, refresh: y } = j({ clusterUuid: s, k8sName: a, k8sNamespace: i, kind: r, isHetero: !0, queueID: v }), { cluster: h } = (0, m.RZ)({ clusterUuid: s }), { jobDetail: b } = null != p ? p : {}, A = (0, l.useMemo)((() => { if (!b) return []; const e = [], t = b.storagePfs, o = b.storageLocal; return null != t && t.length && t.forEach((t => { e.push({ type: (0, q.FD)(q.FK, { children: ["PFS(", cl(Nt.A, { style: { fontSize: 12 }, href: `${u.lW}${null == h ? void 0 : h.aihcpPFS}` }, void 0, null == h ? void 0 : h.aihcpPFS), ")"] }), localPath: t.sourcePath, localMountPath: t.mountPath }) })), null != o && o.length && o.forEach((t => { e.push({ type: "本地路径", localPath: t.localPath, localMountPath: t.mountPath }) })), e }), [b, null == h ? void 0 : h.aihcpPFS]); return !f && p && b ? (0, q.FD)(q.FK, { children: [cl(Ke.Ay, { title: "基本信息" }, void 0, cl(Ee.A, { gutter: [0, 16] }, void 0, cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "任务名称" }, void 0, null !== (e = b.name) && void 0 !== e ? e : "--")), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "资源池/队列" }, void 0, s ? `${null == h ? void 0 : h.clusterName}/${null !== (t = b.queue) && void 0 !== t ? t : "--"}` : null !== (o = b.queue) && void 0 !== o ? o : "--")), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "训练框架" }, void 0, It.pd[b.jobFramework] || b.kind || "")), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "创建人" }, void 0, (null == b || null === (n = b.labels) || void 0 === n ? void 0 : n["aijob.cce.baidubce.com/ai-user-name"]) || "--")), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "创建时间" }, void 0, (0, P.RQ)(b.createdAt))), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "结束时间" }, void 0, b.finishedAt ? (0, P.RQ)(b.finishedAt) : "--")), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "任务耗时" }, void 0, b.createdAt && b.finishedAt ? `${(0, P.nO)((0, P.rm)(b.createdAt, b.finishedAt))}` : "--")), cl(Be.A, { span: 8 }, void 0, cl(Ke.Ay.Field, { title: "优先级" }, void 0, $t.UP[b.priority] || "中", "Created" === b.status && "AscendJob" !== b.kind && cl(xt.d, { record: b, refresh: y }))))), cl(Ke.Ay, { title: "基本配置" }, void 0, cl(g.A, { defaultActiveKey: "p800", items: [{ key: ul.p.p800, label: "KUNLUNXIN P800", children: cl(pl, { jobDetail: b, clusterDetail: h, type: ul.p.p800 }) }, { key: ul.p.a800, label: "NVIDIA A800", children: cl(pl, { jobDetail: b, clusterDetail: h, type: ul.p.a800 }) }] })), cl(Ke.Ay, { title: "数据源" }, void 0, cl(Be.A, { span: 24 }, void 0, cl(Ke.Ay.Field, { title: "数据源" }, void 0, A.length ? cl(gt.A, { style: { width: 700 }, columns: vl, dataSource: A, pagination: !1 }) : "--")))] }) : dl || (dl = cl(C.ui, {}, void 0, cl(d.A, {}))) } var fl, yl, hl; function bl(e, t, o, l) { hl || (hl = "function" == typeof Symbol && Symbol.for && Symbol.for("react.element") || 60103); var n = e && e.defaultProps, a = arguments.length - 3; if (t || 0 === a || (t = { children: void 0 }), 1 === a) t.children = l; else if (a > 1) { for (var i = Array(a), r = 0; r < a; r++)i[r] = arguments[r + 3]; t.children = i } if (t && n) for (var d in n) void 0 === t[d] && (t[d] = n[d]); else t || (t = n || {}); return { $$typeof: hl, type: e, key: void 0 === o ? null : "" + o, ref: null, props: t, _owner: null } } ml.displayName = "Detail"; const { Header: gl, Content: Al, Sider: kl } = i.A; function Sl({ status: e, isLoading: t, clusterUuid: o, k8sName: l }) { return t ? fl || (fl = bl(d.A, {})) : bl("div", { className: "flex" }, void 0, bl("span", { className: "margin-right-10 grey-header-title" }, void 0, o, "/任务"), bl("span", { className: "margin-right-10" }, void 0, l, " 详情"), bl(v.A8, { status: e })) } function Nl({ isHeteroTask: e }) { const { k8sName: t, k8sNamespace: o, clusterUuid: n, kind: a, status: i, from: r, queueID: d, jobId: s } = (0, c.I)(), v = (0, l.useMemo)((() => `?k8sName=${t}&clusterUuid=${n}&jobId=${s}&name=${t}&queueID=${d}&k8sNamespace=${o}&kind=${a}&status=${i}${r ? `&from=${r}` : ""}`), [t, n, s, d, o, a, i, r]), p = [{ label: "任务详情", key: e ? `${u.Ay.task.info.heteroTaskDetail.path()}${v}` : `${u.Ay.task.info.detail.path()}${v}` }, { label: "任务日志", key: `${u.Ay.task.info.log.path()}${v}` }, { label: "WebShell", key: `${u.Ay.task.info.webshell.path()}${v}` }, { label: "任务事件", key: `${u.Ay.task.info.taskEvent.url.path()}${v}` }, { label: "任务监控", key: `${u.Ay.task.info.monitor.path()}${v}` }]; return bl(kl, { fixed: !1, menus: p }) } Sl.displayName = "Summary", Nl.displayName = "Sidebar"; const Il = (0, l.memo)(Nl); function Cl({ isAuthorized: e }) { const t = (0, a.W6)(), { k8sName: o, k8sNamespace: n, clusterUuid: d, kind: f, from: g, queueID: A } = (0, c.I)(), k = window.location.pathname.includes("hetero"), { cluster: S } = (0, m.RZ)({ clusterUuid: d }), { task: N, isLoading: I } = (({ clusterUuid: e, k8sName: t, kind: o, k8sNamespace: n, isHetero: a, queueID: i }) => { const d = (0, l.useMemo)((() => `aiJobDetail/${e}/${t}/${Math.random()}`), [e, t]), [s, u] = (0, l.useState)(4800), c = y(p.vbt), m = y(p.igJ), { data: f, isLoading: h } = (0, r.Ay)(d, (() => a ? m({ clusterUuid: e, k8sName: t, k8sNamespace: n, kind: o, queueID: i }) : c({ clusterUuid: e, k8sName: t, k8sNamespace: n, kind: o, queueID: i })), { refreshInterval: s }); return (0, l.useEffect)((() => { var e; v.yx.includes((null == f || null === (e = f.result) || void 0 === e ? void 0 : e.status) || "") && u(0) }), [f]), { task: null == f ? void 0 : f.result, isLoading: h } })({ clusterUuid: d, k8sName: o, kind: f, k8sNamespace: n, isHetero: k, queueID: A }), C = (0, l.useCallback)((() => { "topology" === g ? t.push(`${u.Ay.resource.topology.path()}?clusterName=${null == S ? void 0 : S.clusterName}&clusterUuid=${d}&queueID=${A}`) : t.goBack() }), [g, t, null == S ? void 0 : S.clusterName, d, A]); return bl(i.A, {}, void 0, bl(gl, { hasBack: !0, onBack: C, summary: bl(Sl, { status: (null == N ? void 0 : N.status) || "", isLoading: I, k8sName: o, clusterUuid: d }), extra: N && bl(al, { record: N }) }), bl(i.A, { detailSider: !0 }, void 0, bl(Il, { isHeteroTask: (0, b.B)(null == N ? void 0 : N.labels) }), bl(Al, {}, void 0, !1 === e ? yl || (yl = bl(h.A, {})) : bl(a.dO, {}, void 0, bl(s.ty, { path: u.Ay.task.info.detail.path(), component: Eo }), bl(s.ty, { path: u.Ay.task.info.heteroTaskDetail.path(), component: ml }), bl(s.ty, { path: u.Ay.task.info.log.path(), component: qe }), bl(s.ty, { path: u.Ay.task.info.webshell.path(), component: Ve }), bl(s.ty, { path: u.Ay.task.info.taskEvent.url.path(), component: vt }), bl(s.ty, { path: u.Ay.task.info.monitor.path(), component: Xo }), bl(a.rd, { to: u.Ay.task.info.detail.path() }))))) } Cl.displayName = "TaskInfoContainer"; var Pl = Cl
    }, 83340: function (e, t, o) { o.d(t, { n: function () { return n } }); var l = o(92935); function n(e, t) { const [o, n] = e.split("-"), [a, i] = t.split("-"); if (o !== a) return o.localeCompare(a); const r = parseInt(n, 10) - parseInt(i, 10); return (0, l.isNaN)(r) ? n.localeCompare(i) : r } }, 88913: function (e, t, o) { o.d(t, { p: function () { return m } }), o(34192), o(88856), o(4865), o(15342), o(20031); var l = o(49431), n = o(86146), a = o(53119), i = o(1302), r = o(83340), d = o(79547), s = o(46938), u = o(23500), c = o(79951), v = o(46746); function p(e, t = !1) { return e && Array.isArray(e.pods) ? e.pods.map((o => { var l, n, a, r; return { restartCount: o.restartCount, replicaType: o.replicaType, namespaceName: o.objectMeta.namespace, podName: o.objectMeta.name, podStatus: o.podStatus.podPhase, podStatusConfig: d.Nb.find((e => e.value === o.podStatus.podPhase)) || { text: o.podStatus.podPhase, value: o.podStatus.podPhase }, podIP: o.PodIP, nodeIP: o.nodeName, cpu: null !== (l = o.metrics) && void 0 !== l && l.cpuUsage ? o.metrics.cpuUsage ? (o.metrics.cpuUsage / 1e3).toFixed(3) : null : 0, mem: null !== (n = o.metrics) && void 0 !== n && n.memoryUsage ? o.metrics.memoryUsage : 0, createTime: o.objectMeta.creationTimestamp, createTimeFormat: (0, i.RQ)(o.objectMeta.creationTimestamp), children: null !== (a = e.faultTolerancePods) && void 0 !== a && a[o.objectMeta.name] ? p({ pods: null === (r = e.faultTolerancePods) || void 0 === r ? void 0 : r[o.objectMeta.name] }, !0) : null, finishedAt: o.finishedAt, executionSeconds: o.executionSeconds, uid: o.objectMeta.uid, isChildren: t } })) : [] } const m = async e => { var t, o, i, d, m, f; const y = e.isHetero ? l.ig : l.Sq, h = await y(e), { success: b, requestId: g, message: A, code: k } = h || {}; if (!b || !h) return (0, n.f)("获取集群详情失败", { requestId: g, message: A, code: k }), null; let S = h.result; if (null !== (t = S) && void 0 !== t && t.rawRequest) { var N, I, C, P, D, w, F, $, x, j; const e = JSON.parse(S.rawRequest), t = e.jobSpec, o = t.Worker, l = t.Master, n = ((null == o ? void 0 : o.replicas) || 0) + ((null == l ? void 0 : l.replicas) || 0), i = o || l, r = (0, s.W)(i.resource)[0], d = (null !== (N = null === (I = e.datasource) || void 0 === I ? void 0 : I.filter((e => (0, u.D7)(e.type, e.pvc)))) && void 0 !== N ? N : []).map((e => { var t, o; return { sourcePath: null !== (t = null == e ? void 0 : e.sourcePath) && void 0 !== t ? t : "/", mountPath: null !== (o = e.mountPath) && void 0 !== o ? o : "--", options: e.options } })), p = (null !== (C = null === (P = e.datasource) || void 0 === P ? void 0 : P.filter((e => !(0, u.D7)(e.type, e.pvc) && "dataset" !== e.type && "devshm" !== e.name))) && void 0 !== C ? C : []).map((e => { var t; return { localPath: (null == e ? void 0 : e.sourcePath) || (null == e || null === (t = e.options) || void 0 === t ? void 0 : t.hostPath), mountPath: e.mountPath, options: e.options } })), m = (null !== (D = null === (w = e.datasource) || void 0 === w ? void 0 : w.filter((e => "cfs" === e.type))) && void 0 !== D ? D : []).map((e => { var t, o; return { sourcePath: null !== (t = null == e ? void 0 : e.sourcePath) && void 0 !== t ? t : "/", mountPath: null !== (o = e.mountPath) && void 0 !== o ? o : "--", options: e.options } })), f = null !== (F = null === ($ = e.datasource) || void 0 === $ ? void 0 : $.filter((e => "dataset" === e.type))) && void 0 !== F ? F : [], y = e.faultTolerance, h = i.resource[r] && n ? i.resource[r] * n : 0, b = (0, c.s)(null === (x = S) || void 0 === x ? void 0 : x.podList); S = { ...i, ...S, storagePfs: d, storageLocal: p, storageDataSet: f, Gpu: null === (j = a.SI[r]) || void 0 === j ? void 0 : j.label, GpuCount: b ? h / 1e4 : h, storageCfs: m, faultTolerance: y, jobSpec: e.jobSpec, hostNetwork: e.hostNetwork, alertConfig: e.alertConfig, annotations: (0, v.k)(e.annotations || {}), codeSource: e.codeSource } } const T = S.podList.pods.sort(((e, t) => (0, r.n)(e.objectMeta.name.replace(`${S.k8sName}-`, ""), t.objectMeta.name.replace(`${S.k8sName}-`, "")))); return S.podList.pods = T, { podData: p(null === (o = S) || void 0 === o ? void 0 : o.podList), jobDetail: Object.assign({}, S, { Gpu: null !== (i = S.Gpu) && void 0 !== i ? i : null === (d = a.SI[S.gpuType]) || void 0 === d ? void 0 : d.label, GpuCount: null !== (m = S.GpuCount) && void 0 !== m ? m : S.gpuCount, pfsId: null === (f = S.annotations) || void 0 === f ? void 0 : f["aijob.cce.baidubce.com/pfs-id"] }) } } }
}]);
//# sourceMappingURL=TaskInfoContainer.66d9d6c1376401fc2031.js.map